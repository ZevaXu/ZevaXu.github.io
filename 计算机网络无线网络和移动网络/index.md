# 计算机网络: 无线网络和移动网络


## 7.1 概述

![20211216-1916-6prmfo-c480](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1916-6prmfo.png)

无线网络中的要素：

* 无线主机。可能移动、可能不动。
* 无线链路。主机通过无线通信链路连接到一个基站或者另外一个主机。
* 基站。负责向与之关联的无线主机发送数据和从主机那接收数据，协调与之相关联的多个无线主机的传输。如蜂窝塔、LAN接入点。
* 网络基础设施

## 7.2 无线链路和网络特征

有线网络和无线网络的重要区别主要在链路层，如：

* 递减的信号强度。电磁波在穿过物体和随之距离增加会减弱（路径损耗）。
* 来自其他源的干扰。同一个频段下发送信号的电波源将相互干扰。
* 多径传播。当电磁波的一部分受物体和地面反射，在发送方和接收方之间走了不同长度的路径，回造成信号模糊。

所以，无线链路中的比特差错比有线链路中更为常见。

信噪比(Signal-to-Noise,SNR)：所收到的信号和噪声强度的相对测量（越大越好）。

比特差错率(BER)：收到的有错传输比特的概率。

* 当调制方案一定，SNR越高，BER越低。发送方通过增加发送功率可以提高SNR，但是当功率超过一定阈值时，不会有显著效果。

* 给定SNR，具有较高比特传输率的调制技术将具有较高的BER。
  
  ![20211216-1916-SZ3z1G-c200](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1916-SZ3z1G.png)

* 物理层调制技术的动态选择能用于适配对信道条件的调制技术。

#### CDMA

码分多址，多址技术的一种，用于一个基站同多个用户传输数据。

时分多址TDMA：也是一种多址技术，将时间分为不同的时间片，每个时间片与一个用户通信。（GSM中使用）

频分多址FDMA：按照频率的不同与多个用户通信。

CDMA比方：

让聚会的客人使用多种语言谈论，人们实际上非常善于锁定他们能听懂的语言，而过滤其他的谈话。

## 7.3 WI-FI：802.11 无线LAN

### 7.3.1 协议及信道与关联

WI-FI协议簇下有几套不同的标准。它们都适用相同的媒体访问协议CSMA/CA、链路层帧使用相同的帧结构、向后兼容（旧设备可以支持新协议）。

![20211216-1917-WMtTnt-c300](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1917-WMtTnt.png)

2.4GHz：2.4～2.458GHz频段，无须执照的频道

5GHz：5.1～5.8GHz频段

**安装一个AP**时，需要分配一个SSID和一个信道号。

SSID：一个AP的服务集标志符号，代表着不同的WI-FI信号。

信道号：在一个频段范围内，不同的信道（2.4GHz频段内就有11个信道，其中有部分是重叠的，仅当两个信道相互隔着4个其他信道时，才叫非重叠的。比如1、6、11信道就是非重叠的）

**无线主机加入AP：**

被动扫描：802.11标准规定每个AP要周期性的发送信标帧，每个信标帧包括该AP的SSID和MAC地址。

主动扫描：通过向无线主机范围内所有的AP发送广播探测帧，AP会响应该探测帧。

一旦主机连接上一个AP，通过DHCP协议获取了一个AP的子网IP。

AP也可以要求主机鉴权：

​    基于MAC地址

​    基于用户名和口令

### 7.3.3 802.11 帧

![20211216-1918-K7Q96k-c460](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1918-K7Q96k.png)

* 有效载荷:承载数据，IP数据报或者ARP分组等。允许的最大长度为2312字节，但是通常小于1500字节。
* CRC：循环冗余校验
* 地址字段：包含4个MAC地址
* 序号、持续期和帧控制字段：序号用于使接收方区分新传输的帧和以前帧的重传；持续期包括了节点预约信道的持续期；

### 7.3.5 802.11 中的高级特色

#### 速率适应

实现了一种具有速率自适应能力，该能力自适应地根据当前和近期信道特点来选择下面的物理层调制技术。

* 如果一个节点连续发送两个帧而没有收到确认（信道上一个比特差错的隐式指示），该传输速率降低到前一个较低的速率。
* 如果 10个帧连续得到确认，或如果用来跟踪自上次降速以来时间的定时器超时，该传输速率提高到上一个较高的速率。

#### 功率管理

功率是移动设备的宝贵资源。

* 一个节点能够明显地在睡眠和唤醒状态之间交替
* 通过将802. 11帧首部的功率管理比特设置为1,某节点向接入点指示它将打算睡眠。
* 对于睡眠状态的主机，AP先缓存帧，待以后传输。
* 每次睡眠时主机设置一个定时器，在下次AP发送信标帧前，恰好唤醒主机。

### 7.3.6 个人域网络：蓝牙和ZigBee

IEEE 802.15.1网络以低功率和低成本在小范围内运行,本质上是一个低功率、小范围、低速率的“电缆替代”技术，用于计算机与其无线键盘、鼠标或其他外部设备如蜂窝电话、扬声器、头戴式耳机及其他设备的互联。
802.15.1网络是自组织网络：不需要网络基础设施（如一个接入点）来互连802.15.1设备。

## 7.4 蜂窝英特网接入

### 7.4.1 蜂窝网体系结构概述
GSM:全球移动通信系统,也就是1G、2G、3G、4G、5G等技术。第一代（1G）系统是模拟FDMA系统，专门用于语音通信；初始的2G系统也是为语音而设计，但后来除了语音服务外还扩展了对数据（即因特网）的支持（2.5G）；3G系统也支持语音和数据，但更为强调数据能力和更高速的无线电接入链路；4G系统基于LTE技术，其特征为全IP核心网络，并且以几兆比特速率提供了话音和数据集成。

**2G蜂窝网体系结构：语音与电话网连接**
![20211216-1711-6Da8Di-c420](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1711-6Da8Di.png)

2G蜂窝系统的GSM标准对空中接口使用了组合的FDM/TDM（无线电）。在组合的FDM/TDM系统中，信道被划分为若干频率子带；对于每个子带，时间又被划分为帧和时隙。因此，对于一个组合的FDM/TDM系统，如果信道被划分为F个子带，并且时间被划分为T个时隙，那么该信道将能够支持F乘T个并发的呼叫。

一个GSM网络的基站控制器（Base Station Controller, BSC）通常服务于几十个收发基站。BSC的责任是为移动用户分配BTS无线信道，执行寻呼（paging）（找出某移动用户所在的小区），执行移动用户的切换。

在用户鉴别和账户管理（决定是否允许某个移动设备与蜂窝网络连接）以及呼叫建立和切换中，移动交换中心（Mobile switching Center, MSC）起着 决定性的作用。单个MSC通常将包含多达5个BSC,因此每个MSC有大约200000个用户。一个蜂窝提供商的网络将有若干MSC,使用称为网关MSC的特殊MSC将提供商的蜂窝网络与更大的公共电话网相连。

### 7.4.2 3G蜂窝数据网：将因特网扩展到蜂窝用户

![20211216-1828-Cj0E3Y-c480](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1828-Cj0E3Y.png)

3G数据服务设计者在不触动现有的核心GSM蜂窝语音网络的前提下，增加了平行的蜂窝数据网络。

### 7.4.3 走向4G：LTE
4G相比3G有两个重要的创新：一个全IP核心网和一个加强的无线电接入网。

**4G系统体系结构：一个全IP核心网**
![20211216-1832-BKchPI-450](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1832-BKchPI.png)
* 一种统一的、全IP网络体系结构：语音通话服务和数据服务都承载在统一的IP服务中。
* 4G数据平面与4G控制平面的清晰分离。

**LTE无线电接入网**
LTE在下行信道采用频分复用和时分复用结合的方法，称之为正交频分复用（OFDM）。在LTE中，每个活跃的移动节点都可以在一个或更多个信道频率上被分配一个或更多个0.5ms时隙。通过分配越来越多的时隙（无论是用相同的频率还是用不同的频率），移动节点能够获取越来越高的传输速率。在移动节点之间进行时隙（重）分配的频度为每毫秒一次。不同的调制方案也能用于改变传输速率。


## 7.5 移动管理：原理

宽泛地讲，移动节点是随时间改变它与网络连接位置的节点。
从网络层角度看，移动用户存在以下几个移动情形：
![20211216-1841-131JVa-c400](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1841-131JVa.png)

然而，最好让移动节点的地址始终保持不变。如果一个移动实体在移动过程中能够保持其IP地址不变，从应用的角度，移动性就变得不可见。即应用程序不必关心IP地址潜在的变化，并且同样的应用程序代码既可用于移动连接，又可用于非移动连接。

**如何维持移动用户在移动过程中保持不变的IP地址呢？**

一个类比的例子：一位20岁左右的青年从家里搬出，成为流动的人, 在一些宿舍或公寓居住，并经常改换住址。如果一个老朋友想与他联系，这位朋友怎样才能找到这个流动的朋友呢？一种常用的方法是与他的家庭取得联系，因为一位流动的青年通常会将其目前的地址告诉家里(即使没有其他原因，哪怕只是为了让父母寄钱来帮他付房租)。其家庭由于有一个永久地址，因此成为其他想与该流动青年联系的人可 采用的第一步。这些朋友后来与他的通信也许是间接的(如先将邮件发送到其父母家, 再转发给该流动的青年)，也许是直接的(如该朋友用得到的地址直接将邮件发送给其流动的朋友)。

实际：
在一个网络环境中，一个移动节点(如一台便携机或智能手机)的永久居所被称为归属网络(home network),在归属网络中代表移动节点执行下面讨论的移动管理功能的实体叫归属代理(home agent)。移动节点当前所在网络叫作外部网络(foreign network)或被访网络(visited network),在外部网络中帮助移动节点做移动管理功能的实体称为外部代理(foreign agent)。

![20211216-1849-GW0lYr-c480](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1849-GW0lYr.png)

外部代理的作用之一就是为移动节点创建一个所谓的转交地址（Care-Of Address, COA）,该COA的网络部分与外部网络的网络部分相匹配。因此一个移动节点可与两个地址相关联，即其永久地址（permanent address）（类比于流动青年的家庭地址）与其COA,该COA有时又称为外部地址（foreign address）（类比于流动青年当前居住的房屋地址）。

### 7.5.2 路由选择到移动节点

**1. 移动节点的间接路有选择（目前所应用的）**

![20211216-1855-1QBUBG-c480](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1855-1QBUBG.png)

归属代理的工作：
1. 负责与外部代理交互以跟踪移动节点的COA。
2. 监视到达的数据报，如果这些数据报寻址的节点的归属网络与该归属代理所在网络相同，但这些节点当前却在某个外部网络中。归属代理截获这些数据报，然后封装并转发它们。
3. 在转发过程，为了维持数据包的原样，归属代理将通信者的原始完整数据报封装（encapsulate）在一个新的（较大的）数据报中。该COA的外部代理将接收并拆封该数据报，即从较大的封装数据报中取岀通信者的原始数据报，然后再向移动节点转发该原始数据报。

涉及到的协议：
1. 移动节点到外部代理的协议。当移动节点连接到外部网络时，它向外部代理注册。类似地，当一个移动节点离开该外部网络时，它将向外部代理取消注册。
2. 外部代理到归属代理的注册协议。外部代理将向归属代理注册移动节点的C0A。当某移动节点离开其网络时，外部代理不需要显式地注销C0A,因为当移动节点移动到一个新网络时，随之而来就要注册一个新的C0A,这将完成了注销。
3. 归属代理数据报封装协议。将通信者的原始数据报封装在一个目的地址为C0A的数据报内，并转发之。
4. 外部代理拆封协议。从封装好的数据报中取出通信者的原始数据报，然后再将该原始数据报转发给移动节点。

**2. 移动节点的直接路由选择**

![20211216-1904-TPFgpj-450](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1904-TPFgpj.png)

间接路由选择存在的问题：三角路由选择问题，即使在通信者与移动节点之间存在一条更有效的路由，发往移动节点的数据报也要先发给归属代理，然后再发送到外部网络。

在直接路由选择方法中，通信者所在网络中的一个通信者代理(correspondent agent)先知道该移动节点的C0A。通信者代理然后将数据报直接通过隧道技术发往移动节点的COA。

虽然解决的三角路由选择问题，但引入了两个其他挑战：
1. 需要一个移动用户定位协议（mobile-user location protocol）,以便通信者代理向归属代理查询获得移动节点的COA。
2. 当移动节点从一个外部网络移到另一个外部网络时，如何将数据报转发到新的外部网络。
引入锚外部节点解决该问题。
![20211216-1909-awwWHN-c480](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1909-awwWHN.png)

## 7.6 移动IP
支持移动性的因特网体系结构与协议合起来称为移动IP。移动IP体系结构包含了许多我们前面考虑过的要素，包括归属代理、外部代理、转交地址和封装/拆封等概念。当前的标准［RFC 5944］规定到移动节点使用间接路由选择的方法。

移动IP标准由三部分组成：

1. 代理发现。移动IP定义了一个归属代理或外部代理用来向移动节点通告其服务的协议，以及移动节点请求一个外部代理或归属代理的服务所使用的协议。 
2. 向归属代理注册。移动IP定义了移动节点和/或外部代理向一个移动节点的归属代理注册或注销COA所使用的协议。
3. 数据报的间接路由选择。该标准也定义了数据报被一个归属代理转发给移动节点的方式，包括转发数据报使用的规则、处理差错情况的规则和几种不同的封装形式.

![20211216-1913-hkxlZa-c500](https://cdn.jsdelivr.net/gh/ZevaXu/picupload@master/uPic/20211216-1913-hkxlZa.png)





